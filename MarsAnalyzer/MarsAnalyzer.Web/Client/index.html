<!DOCTYPE html>
<html style="height: 100%">

<head>

    <link href="Content/bootstrap.css" rel="stylesheet" />
    <link href="Styles/leaflet-bootstrapmodal.css" rel="stylesheet" />
    <link href="Styles/leaflet-jquerydialog.css" rel="stylesheet" />
    <link href="Styles/main.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.3.4/leaflet.css" rel="stylesheet" />

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.3.4/leaflet.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script type="text/javascript" src="Styles/leaflet-bootstrapmodal.js"></script>
    <script type="text/javascript" src="Styles/leaflet-jquerydialog.js"></script>
    <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <title>Landing page</title>
    <meta charset="utf-8" />
</head>

<body style="height: 100%">

        <div class="sketchfab-embed-wrapper"><iframe width="640" height="480" src="https://sketchfab.com/models/fdc477133bd4490cbc9d81ed4e72f19e/embed" frameborder="0" allow="autoplay; fullscreen; vr" mozallowfullscreen="true" webkitallowfullscreen="true"></iframe>

            <p style="font-size: 13px; font-weight: normal; margin: 5px; color: #4A4A4A;">
                <a href="https://sketchfab.com/models/fdc477133bd4490cbc9d81ed4e72f19e?utm_medium=embed&utm_source=website&utm_campaign=share-popup" target="_blank" style="font-weight: bold; color: #1CAAD9;">КРАТЕР 3ds</a>
                by <a href="https://sketchfab.com/sasha.golovach?utm_medium=embed&utm_source=website&utm_campaign=share-popup" target="_blank" style="font-weight: bold; color: #1CAAD9;">sasha.golovach</a>
                on <a href="https://sketchfab.com?utm_medium=embed&utm_source=website&utm_campaign=share-popup" target="_blank" style="font-weight: bold; color: #1CAAD9;">Sketchfab</a>
            </p>
            </div>

        <div id="map" style="width: 100%; height: 100%;"></div>

    <script>
         var map = {};

        $(document).ready(function () {
           
            //define configurations
            var mapSW = [0, 4096],
                mapNE = [4096, 0];
            map = L.map('map').setView([0, 0], 0);
            L.tileLayer('Maps2/{z}/{x}/{y}.png',
                {
                    minZoom: 1,
                    maxZoom: 4,
                    continuousWorld: false,
                    noWrap: true,
                    crs: L.CRS.Simple
                }).addTo(map);

            map.setMaxBounds(new L.LatLngBounds(
                map.unproject(mapSW, map.getMaxZoom()),
                map.unproject(mapNE, map.getMaxZoom())
            ));

            map.on('click', function (e) {
                var points = map.project(e.latlng, map.getMaxZoom().toString());

                // $("#myModal").modal();


                // ajax call to api { points }
                // on success 
                var marker = new L.marker(e.latlng).addTo(map).bindPopup('New item: ...');
            });

            //mock data

            var data = [
                { Id: 5, Name: "Lopata", SketchupId: 1, X: 1000, Y: 1000, redirect: "Some url"},
                { Id: 6, Name: "Lopata1", SketchupId: 2, X: 450, Y: 790 },
                { Id: 7, Name: "Lopata2", SketchupId: 3, X: 3445, Y: 2500 },
                { Id: 8, Name: "Lopata3", SketchupId: 4, X: 1200, Y: 555 }
            ];
            //process data
            processData(data);
        });

        function processData(data) {
            var group1 = [];
            var group2 = [];

            data.forEach(element => {
                var point = L.point(element.X, element.Y);

                var latlng = map.unproject(point, map.getMaxZoom().toString());

                var newMarker = new L.marker(latlng);

                newMarker.bindPopup('Name: <b>' + element.Name + '</b> <br /> Id: <b>' + element.Id + '</b><br /> SketchId: <b> ' + element.SketchupId + ' </b> <br /> <a href="#"> Click here to see model </a>')

                if (element.Id < 7) {
                    group1.push(newMarker.bindTooltip("my tooltip text").openTooltip());
                } else {
                    group2.push(newMarker.bindTooltip("my tooltip text").openTooltip());
                }
            });

            var LgGroup1 = L.layerGroup(group1);
            var LgGroup2 = L.layerGroup(group2);

            var overlayMaps = {
                "Group1": LgGroup1,
                "Group2": LgGroup2
            }

            L.control.layers(null, overlayMaps).addTo(map);
        }

    </script>

</body>
</html>